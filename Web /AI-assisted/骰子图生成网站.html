<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D骰子图像生成器</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#e63946',
                        secondary: '#f5ebe0',
                        accent: '#457b9d',
                        neutral: '#f8f9fa',
                        dark: '#1d3557'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'dice': '0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1)',
                        'button': '0 4px 0 0 rgba(0, 0, 0, 0.2)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .dice-dot {
                @apply absolute rounded-full bg-primary;
                width: 20%;
                height: 20%;
            }
            .button-3d {
                @apply transform active:translate-y-1 active:shadow-none transition-all duration-150;
            }
            .dice-container {
                @apply relative bg-white rounded-lg shadow-dice;
                width: 80px;
                height: 80px;
            }
            .dice-preview {
                @apply relative bg-white rounded-lg shadow-dice;
                width: 160px;
                height: 160px;
            }
            .dice-preview .dice-dot {
                width: 18%;
                height: 18%;
            }
        }
    </style>
</head>
<body class="bg-secondary min-h-screen flex flex-col items-center justify-center p-4">
    <div class="max-w-md w-full bg-white rounded-xl shadow-lg p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-dark mb-2">2D骰子图像生成器</h1>
            <p class="text-gray-600">选择骰子点数，生成80×80像素的骰子图像</p>
        </header>

        <main class="flex flex-col items-center">
            <!-- 骰子预览区域 -->
            <div class="dice-preview mb-8" id="dicePreview">
                <!-- 骰子点数将通过JavaScript动态生成 -->
            </div>

            <!-- 点数选择区域 -->
            <div class="grid grid-cols-3 gap-4 mb-8 w-full max-w-xs">
                <button class="dice-button button-3d bg-primary text-white text-xl font-bold py-4 px-6 rounded-lg shadow-button" data-value="1">1</button>
                <button class="dice-button button-3d bg-primary text-white text-xl font-bold py-4 px-6 rounded-lg shadow-button" data-value="2">2</button>
                <button class="dice-button button-3d bg-primary text-white text-xl font-bold py-4 px-6 rounded-lg shadow-button" data-value="3">3</button>
                <button class="dice-button button-3d bg-primary text-white text-xl font-bold py-4 px-6 rounded-lg shadow-button" data-value="4">4</button>
                <button class="dice-button button-3d bg-primary text-white text-xl font-bold py-4 px-6 rounded-lg shadow-button" data-value="5">5</button>
                <button class="dice-button button-3d bg-primary text-white text-xl font-bold py-4 px-6 rounded-lg shadow-button" data-value="6">6</button>
            </div>

            <!-- 操作按钮区域 -->
            <div class="flex gap-4 w-full max-w-xs">
                <button id="generateButton" class="button-3d bg-accent text-white font-bold py-3 px-6 rounded-lg shadow-button flex-1 flex items-center justify-center">
                    <i class="fa fa-download mr-2"></i> 生成并下载
                </button>
                <button id="randomButton" class="button-3d bg-dark text-white font-bold py-3 px-6 rounded-lg shadow-button flex items-center justify-center">
                    <i class="fa fa-random mr-2"></i> 随机
                </button>
            </div>
        </main>

        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>© 2025 2D骰子图像生成器 | 支持80×80像素</p>
        </footer>
    </div>

    <script>
        // 当前选中的骰子点数
        let currentDiceValue = 1;
        
        // 骰子点数布局配置
        const diceLayouts = {
            1: [
                [50, 50]  // 中心点
            ],
            2: [
                [25, 25], // 左上角
                [75, 75]  // 右下角
            ],
            3: [
                [25, 25], // 左上角
                [50, 50], // 中心点
                [75, 75]  // 右下角
            ],
            4: [
                [25, 25], // 左上角
                [25, 75], // 左下角
                [75, 25], // 右上角
                [75, 75]  // 右下角
            ],
            5: [
                [25, 25], // 左上角
                [25, 75], // 左下角
                [50, 50], // 中心点
                [75, 25], // 右上角
                [75, 75]  // 右下角
            ],
            6: [
                [25, 25], // 左上角
                [25, 50], // 左中
                [25, 75], // 左下角
                [75, 25], // 右上角
                [75, 50], // 右中
                [75, 75]  // 右下角
            ]
        };

        // DOM元素
        const dicePreview = document.getElementById('dicePreview');
        const diceButtons = document.querySelectorAll('.dice-button');
        const generateButton = document.getElementById('generateButton');
        const randomButton = document.getElementById('randomButton');

        // 初始化
        function init() {
            // 渲染初始骰子（1点）
            renderDice(currentDiceValue, dicePreview);
            
            // 添加事件监听器
            diceButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const value = parseInt(button.dataset.value);
                    currentDiceValue = value;
                    renderDice(value, dicePreview);
                    
                    // 更新按钮样式
                    diceButtons.forEach(btn => btn.classList.remove('ring-4', 'ring-yellow-400'));
                    button.classList.add('ring-4', 'ring-yellow-400');
                });
            });
            
            // 生成按钮点击事件
            generateButton.addEventListener('click', generateAndDownloadDice);
            
            // 随机按钮点击事件
            randomButton.addEventListener('click', () => {
                const randomValue = Math.floor(Math.random() * 6) + 1;
                currentDiceValue = randomValue;
                renderDice(randomValue, dicePreview);
                
                // 更新按钮样式
                diceButtons.forEach(btn => {
                    if (parseInt(btn.dataset.value) === randomValue) {
                        btn.classList.add('ring-4', 'ring-yellow-400');
                    } else {
                        btn.classList.remove('ring-4', 'ring-yellow-400');
                    }
                });
            });

            // 默认选中第一个按钮
            diceButtons[0].classList.add('ring-4', 'ring-yellow-400');
        }

        // 渲染骰子
        function renderDice(value, container) {
            // 清空容器
            container.innerHTML = '';
            
            // 获取当前点数的布局
            const layout = diceLayouts[value];
            
            // 添加点数
            layout.forEach(position => {
                const dot = document.createElement('div');
                dot.classList.add('dice-dot');
                
                // 设置位置（使用百分比）
                dot.style.left = `${position[0]}%`;
                dot.style.top = `${position[1]}%`;
                
                // 调整中心点
                dot.style.transform = 'translate(-50%, -50%)';
                
                container.appendChild(dot);
            });
        }

        // 生成并下载骰子图像
        function generateAndDownloadDice() {
            // 创建一个临时的div来生成80x80的骰子
            const tempDice = document.createElement('div');
            tempDice.classList.add('dice-container');
            tempDice.style.position = 'absolute';
            tempDice.style.left = '-9999px';
            document.body.appendChild(tempDice);
            
            // 渲染80x80的骰子
            renderDice(currentDiceValue, tempDice);
            
            // 使用html2canvas库将div转换为图像
            html2canvas(tempDice).then(canvas => {
                // 创建下载链接
                const link = document.createElement('a');
                link.download = `dice-${currentDiceValue}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // 移除临时元素
                document.body.removeChild(tempDice);
                
                // 显示成功提示
                showNotification('骰子图像已生成并下载');
            });
        }

        // 显示通知
        function showNotification(message) {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.classList.add('fixed', 'top-4', 'right-4', 'bg-green-500', 'text-white', 'py-2', 'px-4', 'rounded-lg', 'shadow-lg', 'transition-opacity', 'duration-300');
            notification.textContent = message;
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 淡出效果
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // 加载html2canvas库
        function loadHtml2Canvas() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', () => {
            loadHtml2Canvas().then(init).catch(error => {
                console.error('Failed to load html2canvas:', error);
                alert('生成图像功能需要html2canvas库，请检查您的网络连接。');
            });
        });
    </script>
</body>
</html>
